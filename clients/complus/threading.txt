Threading example

    /*  Create server thread                                                 */
    thread = CreateThread (
        NULL,
        0,
        (LPTHREAD_START_ROUTINE) SMT_thread,
        NULL,                           /*  No argument                      */
        0,                              /*  And run thread at once           */
        (LPDWORD) &thread_id);

    if (thread == NULL)
      {
        MessageBox (NULL, "Could not initialise Xitami web server",
                    NULL, MB_ICONEXCLAMATION);
        return (1);
      }
    else
        SetThreadPriority (thread, THREAD_PRIORITY_NORMAL);



    /*  Now loop until we are finished                                       */
    while (GetMessage (&msg, main_window, 0, 0))
      {
        if (IsDialogMessage (http_window, &msg))
            continue;

        TranslateMessage (&msg);
        DispatchMessage  (&msg);
      }


    main_window = CreateWindow (
                NULL);                  /* Create struct for WM_CREATE       */



static long
SMT_thread (void)
{
    FOREVER
      {
        __try
          {
            smt_exec_full ();           /*  Run until completed              */
          }
        __except (report_smt_error ())
          {
          }
      }
    /*  Tell main window to exit         */
    PostMessage (main_window, WM_QUIT, 0, 0);

    ExitThread (0);
    return (0);
}
