<?xml?>
<pal script = "amq_pal_gen" >
    <session>
        <exchange_declare exchange = "mydirectexchange" type = "direct" />
        <queue_declare queue = "mydirectqueue" />
        <queue_bind queue = "mydirectqueue" exchange = "mydirectexchange">
            <arguments>
                <field name = "x" value = "a" />
            </arguments>
        </queue_bind>
        <basic_consume queue = "mydirectqueue" />
        <wait/>
        <timer/>
        <basic_arrived>
            <inc name = "messages"/>
            <echo>In $messages: [$message_id] with x=$headers-x y=$headers-y z=$headers-z</echo>
        </basic_arrived>
        <empty>
            <abort>No message</abort>
        </empty>
        <repeat times = "10000">
            <wait />
            <basic_arrived>
                <!-- <inc name = "messages"/>
                <echo>In $messages: [$message_id] with x=$headers-x y=$headers-y z=$headers-z</echo>
                -->
            </basic_arrived>
            <empty>
                <abort>No message</abort>
            </empty>
        </repeat>
        <timer action = "show" />
    </session>
    
</pal>


