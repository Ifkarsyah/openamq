<?xml?>
<pal script = "amq_pal_gen">
    <set name = "count" value = "4" cmdline = "C" />
    <session>
        <exchange_declare exchange = "mytopicexchange" type = "topic" />
        <queue_declare queue = "mytopicqueue" />
        <repeat times = "1000" counter = "counter">
            <queue_bind queue = "mytopicqueue" exchange = "mytopicexchange" routing_key = "foo.bar.baz.$counter" />
        </repeat>
        <basic_consume queue = "mytopicqueue" />

        <wait/>
        <timer/>
        <basic_arrived>
            <echo>[$message_id] with rk=$routing_key</echo>
        </basic_arrived>
        <empty>
            <abort>No message</abort>
        </empty>
        <repeat times = "$count">
            <wait />
            <basic_arrived>
                <echo>[$message_id] with rk=$routing_key</echo>
            </basic_arrived>
            <empty>
                <abort>No message</abort>
            </empty>
        </repeat>
        <timer action = "show" />
    </session>
    
</pal>


