<?xml?>
<pal
    script = "amq_pal_gen"
    desc   = "GRM-131"
    >
    <session>
        <exchange_declare exchange = "myexchange" type = "headers" />
        <queue_declare queue = "myqueue" />
        <queue_bind queue = "myqueue" exchange = "myexchange" />
        <basic_consume queue = "myqueue" />
        <repeat>
            <wait/>
            <basic_arrived>
                <inc name = "messages" />
                <echo>In $messages: [$message_id]</echo>
                <basic_content message_id = "$message_id.1" />
                <basic_publish exchange = "recv" />
                <basic_content message_id = "$message_id.2" />
                <basic_publish exchange = "recv" />
            </basic_arrived>
            <empty>
                <abort>No message arrived</abort>
            </empty>
        </repeat>
    </session>
</pal>

