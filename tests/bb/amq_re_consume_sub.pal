<?xml?>
<pal
    script = "amq_pal_gen"
    desc   = ""
    >
    <session>
        <exchange_declare exchange = "exchange" type = "direct" />
        <queue_declare queue = "$queue" />
        <queue_bind queue = "$queue" exchange = "exchange" routing_key = "gen_pub"/>
        <repeat>
            <echo>P: start consuming</echo>
            <basic_consume queue = "$queue" />
            <set name = "count" value = "10" cmdline = "C" />
            <repeat counter = "loop" >
                <wait />
                <basic_arrived>
                    <echo>I: message '$message_id' arrived</echo>
                </basic_arrived>
                <if name = "loop" test = "eq" value = "count" >
                    <echo>P: cancelling consumer</echo>
                    <basic_cancel queue = "$queue" consumer_tag = "$consumer_tag" />
                    <break />
                </if>
            </repeat>
        </repeat>
    </session>
</pal>


