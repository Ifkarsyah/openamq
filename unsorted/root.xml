<?xml version="1.0"?>
<root>
    <dfl
        script = "dfl_gen"
        name = "amq_db"
        description = "OpenAMQ database framework layer"
        author = "iMatix Corporation"
        target = "bdb"
        prefix = "db"
        _entity = "dfl"
        realname = "amq_db"
        clean_ids = "1">
        <rule
            name = "clean ids"
            _entity = "dfl rule"/>
        <inherit
            filename = "prelude.dfl"
            _entity = "inherit"/>
        <table
            name = "client"
            description = "Client"
            _entity = "table"
            realname = "dbclient"
            automaticid = "1"
            automaticidtype = "qbyte">
    Defines a client who has or is using the application.
        <field
                name = "id"
                domain = "recordid"
                _entity = "table-field"
                type = "numeric"
                size = "9"
                required = "1"
                realname = "dbid"
                default = "0"
                realtype = "qbyte">Record id<rule
                    name = "recordid"
                    when = "insert"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "recordid"
                    when = "insert"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <index
                    name = "primary"
                    number = "1"/>
            </field>
            <field
                name = "name"
                domain = "shortstr"
                _entity = "table-field"
                type = "textual"
                size = "255"
                realname = "dbname"
                default = ""
                required = "0"
                realtype = "ipr_shortstr_t">Client external name<index
                    name = "byname"
                    number = "1"/>
            </field>
            <field
                name = "connected"
                domain = "boolean"
                _entity = "table-field"
                type = "boolean"
                realname = "dbconnected"
                default = "0"
                required = "0"
                realtype = "byte">Currently connected?</field>
            <field
                name = "enabled"
                domain = "boolean"
                _entity = "table-field"
                type = "boolean"
                realname = "dbenabled"
                default = "0"
                required = "0"
                realtype = "byte">Allowed to connect?</field>
            <field
                name = "lastused"
                domain = "timestamp"
                _entity = "table-field"
                type = "timestamp"
                realname = "dblastused"
                default = "0"
                required = "0"
                realtype = "time_t">Last time connected</field>
            <index
                name = "byname"
                _entity = "index"
                realname = "1"
                unique = "0">
                <field
                    name = "name"
                    _entity = "index-field"
                    realname = "dbname"
                    order = "ascending"
                    domain = "shortstr"
                    type = "textual"
                    size = "255"
                    default = ""
                    required = "0"
                    realtype = "ipr_shortstr_t"/>
            </index>
            <index
                name = "primary"
                _entity = "index"
                realname = "1"
                unique = "0">
                <field
                    name = "id"
                    _entity = "index-field"
                    realname = "dbid"
                    order = "ascending"
                    domain = "recordid"
                    type = "numeric"
                    size = "9"
                    default = "0"
                    required = "1"
                    realtype = "qbyte"/>
            </index>
        </table>
        <table
            name = "dest"
            description = "Destination"
            _entity = "table"
            realname = "dbdest"
            automaticid = "1"
            automaticidtype = "qbyte">
    Defines a temporary or long-lived destination.
        <field
                name = "id"
                domain = "recordid"
                _entity = "table-field"
                type = "numeric"
                size = "9"
                required = "1"
                realname = "dbid"
                default = "0"
                realtype = "qbyte">Record id<rule
                    name = "recordid"
                    when = "insert"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "recordid"
                    when = "insert"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <index
                    name = "primary"
                    number = "1"/>
            </field>
            <field
                name = "type"
                domain = "shortint"
                _entity = "table-field"
                type = "numeric"
                size = "2"
                realname = "dbtype"
                default = "0"
                required = "0"
                realtype = "byte">1=Queue, 2=Topic<index
                    name = "byname"
                    number = "1"/>
            </field>
            <field
                name = "temporary"
                domain = "boolean"
                _entity = "table-field"
                type = "boolean"
                realname = "dbtemporary"
                default = "0"
                required = "0"
                realtype = "byte">Temporary destination?</field>
            <field
                name = "subscribe"
                domain = "boolean"
                _entity = "table-field"
                type = "boolean"
                realname = "dbsubscribe"
                default = "0"
                required = "0"
                realtype = "byte">Subscriber queue?</field>
            <field
                name = "name"
                domain = "shortstr"
                _entity = "table-field"
                type = "textual"
                size = "255"
                realname = "dbname"
                default = ""
                required = "0"
                realtype = "ipr_shortstr_t">Destination name<index
                    name = "byname"
                    number = "2"/>
            </field>
            <field
                name = "clientid"
                domain = "id"
                _entity = "table-field"
                type = "numeric"
                size = "9"
                realname = "dbclientid"
                default = "0"
                required = "0"
                realtype = "qbyte">Owned by this client<rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
            </field>
            <index
                name = "byname"
                unique = "1"
                _entity = "index"
                realname = "1">
                <field
                    name = "type"
                    _entity = "index-field"
                    realname = "dbtype"
                    order = "ascending"
                    domain = "shortint"
                    type = "numeric"
                    size = "2"
                    default = "0"
                    required = "0"
                    realtype = "byte"/>
                <field
                    name = "name"
                    _entity = "index-field"
                    realname = "dbname"
                    order = "ascending"
                    domain = "shortstr"
                    type = "textual"
                    size = "255"
                    default = ""
                    required = "0"
                    realtype = "ipr_shortstr_t"/>
            </index>
            <index
                name = "primary"
                _entity = "index"
                realname = "1"
                unique = "0">
                <field
                    name = "id"
                    _entity = "index-field"
                    realname = "dbid"
                    order = "ascending"
                    domain = "recordid"
                    type = "numeric"
                    size = "9"
                    default = "0"
                    required = "1"
                    realtype = "qbyte"/>
            </index>
        </table>
        <table
            name = "mesg"
            description = "Message"
            _entity = "table"
            realname = "dbmesg"
            automaticid = "1"
            automaticidtype = "qbyte">
    Holds one message saved to persistent storage.
        <field
                name = "id"
                domain = "recordid"
                _entity = "table-field"
                type = "numeric"
                size = "9"
                required = "1"
                realname = "dbid"
                default = "0"
                realtype = "qbyte">Record id<rule
                    name = "recordid"
                    when = "insert"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "recordid"
                    when = "insert"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <index
                    name = "bydest"
                    number = "2"/>
                <index
                    name = "primary"
                    number = "1"/>
            </field>
            <field
                name = "destid"
                domain = "id"
                _entity = "table-field"
                type = "numeric"
                size = "9"
                realname = "dbdestid"
                default = "0"
                required = "0"
                realtype = "qbyte">Parent destination<rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <index
                    name = "bydest"
                    number = "1"/>
            </field>
            <field
                name = "clientid"
                domain = "id"
                _entity = "table-field"
                type = "numeric"
                size = "9"
                realname = "dbclientid"
                default = "0"
                required = "0"
                realtype = "qbyte">Owned by this client<rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
            </field>
            <field
                name = "body size"
                domain = "longint"
                _entity = "table-field"
                type = "numeric"
                size = "4"
                realname = "dbbody size"
                default = "0"
                required = "0"
                realtype = "dbyte">Message body size</field>
            <field
                name = "priority"
                domain = "octet"
                _entity = "table-field"
                type = "numeric"
                size = "1"
                realname = "dbpriority"
                default = "0"
                required = "0"
                realtype = "byte">Priority, 0-9</field>
            <field
                name = "expiration"
                domain = "longint"
                _entity = "table-field"
                type = "numeric"
                size = "4"
                realname = "dbexpiration"
                default = "0"
                required = "0"
                realtype = "dbyte">Expiry date/time</field>
            <field
                name = "mime type"
                domain = "shortstr"
                _entity = "table-field"
                type = "textual"
                size = "255"
                realname = "dbmime type"
                default = ""
                required = "0"
                realtype = "ipr_shortstr_t">Content MIME type</field>
            <field
                name = "encoding"
                domain = "shortstr"
                _entity = "table-field"
                type = "textual"
                size = "255"
                realname = "dbencoding"
                default = ""
                required = "0"
                realtype = "ipr_shortstr_t">Content encoding</field>
            <field
                name = "identifier"
                domain = "longstr"
                _entity = "table-field"
                type = "textual"
                size = "4096"
                realname = "dbidentifier"
                default = ""
                required = "0"
                realtype = "idb_hackstr_t">Message identifier</field>
            <field
                name = "headers"
                domain = "longstr"
                _entity = "table-field"
                type = "textual"
                size = "4096"
                realname = "dbheaders"
                default = ""
                required = "0"
                realtype = "idb_hackstr_t">Application headers</field>
            <field
                name = "content"
                domain = "longstr"
                _entity = "table-field"
                type = "textual"
                size = "4096"
                realname = "dbcontent"
                default = ""
                required = "0"
                realtype = "idb_hackstr_t">First body fragment</field>
            <index
                name = "bydest"
                _entity = "index"
                realname = "1"
                unique = "0">
                <field
                    name = "destid"
                    _entity = "index-field"
                    realname = "dbdestid"
                    order = "ascending"
                    domain = "id"
                    type = "numeric"
                    size = "9"
                    default = "0"
                    required = "0"
                    realtype = "qbyte"/>
                <field
                    name = "id"
                    _entity = "index-field"
                    realname = "dbid"
                    order = "ascending"
                    domain = "recordid"
                    type = "numeric"
                    size = "9"
                    default = "0"
                    required = "1"
                    realtype = "qbyte"/>
            </index>
            <index
                name = "primary"
                _entity = "index"
                realname = "1"
                unique = "0">
                <field
                    name = "id"
                    _entity = "index-field"
                    realname = "dbid"
                    order = "ascending"
                    domain = "recordid"
                    type = "numeric"
                    size = "9"
                    default = "0"
                    required = "1"
                    realtype = "qbyte"/>
            </index>
        </table>
        <domain
            name = "audit"
            type = "group"
            _entity = "domain">Audit information
<rule
                name = "soft delete"
                when = "object"
                what = "active"
                value = "0"
                _entity = "rule"/>
            <field
                name = "createdts"
                type = "timestamp"
                _entity = "domain-field"
                realname = "dbcreatedts"
                required = "0">Date/time record was created
    <rule
                    name = "timestamp"
                    when = "insert"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "ignore"
                    when = "object"
                    _entity = "rule"/>
            </field>
            <field
                name = "createdby"
                domain = "id"
                _entity = "domain-field"
                realname = "dbcreatedby"
                required = "0"
                type = "numeric"
                size = "9">User who created record
    <rule
                    name = "userid"
                    when = "insert"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "ignore"
                    when = "object"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
            </field>
            <field
                name = "revisedts"
                type = "timestamp"
                _entity = "domain-field"
                realname = "dbrevisedts"
                required = "0">Date/time record was modified
    <rule
                    name = "timestamp"
                    when = "insert"
                    _entity = "rule"/>
                <rule
                    name = "timestamp"
                    when = "update"
                    _entity = "rule"/>
                <rule
                    name = "timestamp"
                    when = "delete"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "ignore"
                    when = "object"
                    _entity = "rule"/>
            </field>
            <field
                name = "revisedby"
                domain = "id"
                _entity = "domain-field"
                realname = "dbrevisedby"
                required = "0"
                type = "numeric"
                size = "9">User who modified record
    <rule
                    name = "userid"
                    when = "insert"
                    _entity = "rule"/>
                <rule
                    name = "userid"
                    when = "update"
                    _entity = "rule"/>
                <rule
                    name = "userid"
                    when = "delete"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "ignore"
                    when = "object"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
            </field>
            <field
                name = "active"
                type = "boolean"
                _entity = "domain-field"
                realname = "dbactive"
                required = "0">Is record active?
    <rule
                    name = "set"
                    when = "insert"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "set"
                    when = "delete"
                    value = "0"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "hidden"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "ignore"
                    when = "object"
                    _entity = "rule"/>
            </field>
        </domain>
        <domain
            name = "createdts"
            type = "timestamp"
            _entity = "domain">Date/time record was created
    <rule
                name = "timestamp"
                when = "insert"
                _entity = "rule"/>
            <rule
                name = "show"
                when = "all"
                what = "hidden"
                value = "1"
                _entity = "rule"/>
            <rule
                name = "ignore"
                when = "object"
                _entity = "rule"/>
        </domain>
        <domain
            name = "revisedts"
            type = "timestamp"
            _entity = "domain">Date/time record was modified
    <rule
                name = "timestamp"
                when = "insert"
                _entity = "rule"/>
            <rule
                name = "timestamp"
                when = "update"
                _entity = "rule"/>
            <rule
                name = "show"
                when = "all"
                what = "hidden"
                value = "1"
                _entity = "rule"/>
            <rule
                name = "ignore"
                when = "object"
                _entity = "rule"/>
        </domain>
        <domain
            name = "language"
            type = "textual"
            size = "5"
            default = "en"
            _entity = "domain"/>
        <domain
            name = "timerange"
            type = "group"
            _entity = "domain">
            <field
                name = "from"
                domain = "timeslot"
                _entity = "domain-field"
                realname = "dbfrom"
                required = "0"
                type = "time">Start time<rule
                    name = "show"
                    when = "all"
                    what = "starthour"
                    value = "0"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "endhour"
                    value = "23"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "interval"
                    value = "1"
                    _entity = "rule"/>
            </field>
            <field
                name = "to"
                domain = "timeslot"
                _entity = "domain-field"
                realname = "dbto"
                required = "0"
                type = "time">End time
        <rule
                    name = "show"
                    when = "layout"
                    what = "label"
                    value = "End time"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "layout"
                    what = "join"
                    value = "1"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "starthour"
                    value = "0"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "endhour"
                    value = "23"
                    _entity = "rule"/>
                <rule
                    name = "show"
                    when = "all"
                    what = "interval"
                    value = "1"
                    _entity = "rule"/>
            </field>
        </domain>
        <domain
            name = "timeslot"
            type = "time"
            _entity = "domain">
            <rule
                name = "show"
                when = "all"
                what = "starthour"
                value = "0"
                _entity = "rule"/>
            <rule
                name = "show"
                when = "all"
                what = "endhour"
                value = "23"
                _entity = "rule"/>
            <rule
                name = "show"
                when = "all"
                what = "interval"
                value = "1"
                _entity = "rule"/>
        </domain>
        <domain
            name = "recordid"
            type = "numeric"
            size = "9"
            required = "1"
            _entity = "domain">
            <rule
                name = "recordid"
                when = "insert"
                _entity = "rule"/>
            <rule
                name = "show"
                when = "all"
                what = "hidden"
                value = "1"
                _entity = "rule"/>
        </domain>
        <domain
            name = "id"
            type = "numeric"
            size = "9"
            _entity = "domain">
            <rule
                name = "show"
                when = "all"
                what = "hidden"
                value = "1"
                _entity = "rule"/>
        </domain>
        <domain
            name = "octet"
            type = "numeric"
            size = "1"
            _entity = "domain"/>
        <domain
            name = "shortint"
            type = "numeric"
            size = "2"
            _entity = "domain"/>
        <domain
            name = "longint"
            type = "numeric"
            size = "4"
            _entity = "domain"/>
        <domain
            name = "shortstr"
            type = "textual"
            size = "255"
            _entity = "domain"/>
        <domain
            name = "longstr"
            type = "textual"
            size = "4096"
            _entity = "domain"/>
        <domain
            name = "date"
            type = "date"
            _entity = "domain"/>
        <domain
            name = "boolean"
            type = "boolean"
            _entity = "domain"/>
        <domain
            name = "timestamp"
            type = "timestamp"
            _entity = "domain"/>
    </dfl>
</root>
