<?xml?>
<pal
    script = "amq_pal_gen"
    desc   = "GRM-like consumer"
    >
    
    <include filename = "amq_test_base.pal" />
    <session>
        <set name = "a" value = "verb1" cmdline = "V" />
        <set name = "b" value = "test" cmdline = "T" />
        <exchange_declare exchange = "pubsub" type = "headers" />
        <queue_declare />
        <queue_bind queue = "$queue" exchange = "pubsub" >
            <arguments>
                <field name = "Verb" value = "$a" />
                <field name = "Text" value = "$b" />
            </arguments>
        </queue_bind>
        <basic_consume queue = "$queue" />
        <wait timeout = "5000" />
        <repeat counter = "count" >
            <basic_arrived>
                <echo>Publish #$count arrived</echo>
            </basic_arrived>
            <empty>
                <echo>Message queue currently empty</echo>
            </empty>
            <wait timeout = "0" />
        </repeat>
    </session>
</pal>
