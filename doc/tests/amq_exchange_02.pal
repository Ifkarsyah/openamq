<?xml?>
<pal
    name   = "amq_exchange_02"
    script = "amq_pal_gen"
    desc   = "Declare an exchange which is automatically deleted, and test deletion."
    >
    This test sets up a session where an auto_delete exchange is created. Then
    it opens up a new session (with a new connection) to check if the exchange
    has been deleted. This is done by a passive exchange declaration, which
    returns a reply_code of 504 if the exchange is gone.

    
    <include filename = "amq_test_base.pal" />
    <session>
        <exchange_declare exchange = "myexchange" type = "fanout" auto_delete = "1" />
    </session>
    <session error_handling = "recover" restart = "1">
        <exchange_declare exchange = "myexchange" type = "fanout" passive = "1" />
        <assert name = "reply_code" value = "404" />
    </session>

</pal>


