<?xml?>
<pal script = "amq_pal_gen">
    Publishes a stable stream of request/reply (direct exchange) messages.

    Command line arguments:
    -A maximal interval between messages (in milliseconds)
    -B maximal size of a message (in bytes)
    <set name = "delay_cmdline" value = "200" cmdline = "A" />
    <set name = "msg_size_cmdline" value = "1024" cmdline = "B" />
    <session>
        <repeat>
            <!-- Publish 9 common messages -->
            <repeat times = "9">
                <set_random name = "msg_size" max = "$msg_size_cmdline" />
                <basic_content size = "$msg_size" message_id = "RRS"/>
                <basic_publish exchange = "amq.direct" routing_key = "stable" />
                <set_random name = "delay" min = "1" max = "$delay_cmdline" />
                <wait timeout = "$delay" />
            </repeat>
            <!-- Publish synchronisation message -->
            <set_random name = "msg_size" max = "$msg_size_cmdline" />
            <basic_content size = "$msg_size" message_id = "RRS-SYNC"/>
            <basic_publish exchange = "amq.direct" routing_key = "stable" />
            <set_random name = "delay" min = "1" max = "$delay_cmdline" />
            <wait timeout = "$delay" />
        </repeat>
    </session>
</pal>
